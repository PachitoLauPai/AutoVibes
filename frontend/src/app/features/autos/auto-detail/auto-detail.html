<div class="container py-5">
  
  <!-- LOADING -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-3 text-muted">Cargando informaci√≥n del auto...</p>
  </div>

  <!-- ERROR -->
  <div *ngIf="error && !loading" class="alert alert-danger alert-dismissible fade show" role="alert">
    ‚ùå {{ error }}
    <button type="button" class="btn-close" (click)="error = ''; volverALista()"></button>
  </div>

  <!-- AUTO DETAIL CONTENT -->
  <div *ngIf="auto && !loading" class="row">
    
    <!-- BREADCRUMB -->
    <div class="col-12 mb-4">
      <button class="btn btn-outline-secondary" (click)="volverALista()">
        ‚Üê Volver a la lista
      </button>
    </div>

    <!-- IMAGE GALLERY (LEFT) -->
    <div class="col-lg-6 mb-4">
      <div class="card border-0 shadow-sm">
        
        <!-- MAIN IMAGE WITH CAROUSEL -->
        <div id="carouselAuto" class="carousel slide" data-bs-ride="carousel" *ngIf="auto.imagenes && auto.imagenes.length > 0">
          <div class="carousel-inner">
            <div *ngFor="let imagen of auto.imagenes; let i = index" 
                 class="carousel-item" 
                 [class.active]="i === 0">
              <img [src]="imagen" 
                   [alt]="auto.modelo"
                   (error)="handleImageError($event)"
                   class="d-block w-100" 
                   style="height: 400px; object-fit: cover;">
            </div>
          </div>

          <!-- CAROUSEL CONTROLS -->
          <button class="carousel-control-prev" type="button" data-bs-target="#carouselAuto" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carouselAuto" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
          </button>

          <!-- IMAGE COUNTER -->
          <div class="position-absolute bottom-0 start-50 translate-middle-x mb-3">
            <span class="badge bg-dark">{{ currentImageIndex + 1 }} / {{ auto.imagenes.length }}</span>
          </div>
        </div>

        <!-- SINGLE IMAGE IF NO CAROUSEL -->
        <img *ngIf="!auto.imagenes || auto.imagenes.length === 0"
             [src]="getPlaceholderImage()"
             [alt]="auto.modelo"
             class="card-img-top"
             style="height: 400px; object-fit: cover;">

        <!-- THUMBNAILS -->
        <div *ngIf="auto.imagenes && auto.imagenes.length > 1" class="card-footer bg-light">
          <div class="d-flex gap-2 overflow-auto">
            <img *ngFor="let img of auto.imagenes; let i = index"
                 [src]="img"
                 [alt]="'Miniatura ' + (i + 1)"
                 (click)="goToImage(i)"
                 (error)="handleImageError($event)"
                 class="img-thumbnail"
                 style="width: 60px; height: 45px; cursor: pointer; object-fit: cover;"
                 [class.border-primary]="i === currentImageIndex"
                 [class.border-3]="i === currentImageIndex">
            >
          </div>
        </div>
      </div>
    </div>

    <!-- AUTO INFORMATION (RIGHT) -->
    <div class="col-lg-6">
      <div class="card border-0 shadow-sm">
        <div class="card-body">

          <!-- TITLE -->
          <h1 class="card-title fw-bold mb-2">
            {{ auto.marca?.nombre }} {{ auto.modelo }}
          </h1>

          <!-- PRICE AND STATUS -->
          <div class="mb-4">
            <h2 class="text-danger fw-bold" style="font-size: 2.5rem;">
              S/ {{ auto.precio | number:'1.2-2' }}
            </h2>
            <span [class]="'badge ' + (auto.disponible ? 'bg-success' : 'bg-danger')"
                  style="font-size: 1rem; padding: 0.5rem 1rem;">
              {{ auto.disponible ? '‚úÖ Disponible' : 'üí∞ Vendido' }}
            </span>
          </div>

          <!-- SPECIFICATIONS -->
          <div class="row g-3 mb-4">
            <div class="col-6">
              <div class="p-3 bg-light rounded">
                <small class="text-muted d-block">üìÖ A√±o</small>
                <strong>{{ auto.anio }}</strong>
              </div>
            </div>
            <div class="col-6">
              <div class="p-3 bg-light rounded">
                <small class="text-muted d-block">üõ£Ô∏è Kilometraje</small>
                <strong>{{ auto.kilometraje | number }} km</strong>
              </div>
            </div>
            <div class="col-6">
              <div class="p-3 bg-light rounded">
                <small class="text-muted d-block">üé® Color</small>
                <strong>{{ auto.color }}</strong>
              </div>
            </div>
            <div class="col-6">
              <div class="p-3 bg-light rounded">
                <small class="text-muted d-block">‚õΩ Combustible</small>
                <strong>{{ auto.combustible?.nombre }}</strong>
              </div>
            </div>
            <div class="col-6">
              <div class="p-3 bg-light rounded">
                <small class="text-muted d-block">üîß Transmisi√≥n</small>
                <strong>{{ auto.transmision?.nombre }}</strong>
              </div>
            </div>
            <div class="col-6">
              <div class="p-3 bg-light rounded">
                <small class="text-muted d-block">üìÇ Categor√≠a</small>
                <strong>{{ auto.categoria?.nombre }}</strong>
              </div>
            </div>
            <div class="col-6">
              <div class="p-3 bg-light rounded">
                <small class="text-muted d-block">üìä Condici√≥n</small>
                <strong>{{ auto.condicion?.nombre }}</strong>
              </div>
            </div>
            <div class="col-6">
              <div class="p-3 bg-light rounded">
                <small class="text-muted d-block">‚úîÔ∏è Estado</small>
                <strong class="text-success" *ngIf="auto.disponible">Disponible</strong>
                <strong class="text-danger" *ngIf="!auto.disponible">No Disponible</strong>
              </div>
            </div>
          </div>

          <!-- DESCRIPTION -->
          <div class="mb-4">
            <h5 class="fw-bold mb-2">Descripci√≥n</h5>
            <p class="text-muted">{{ auto.descripcion }}</p>
          </div>

          <!-- ACTION BUTTONS -->
          <div class="d-grid gap-2">
            <button *ngIf="auto.disponible"
                    class="btn btn-primary btn-lg"
                    (click)="openContactModal()">
              üìû Contactar al Vendedor
            </button>
            <button *ngIf="!auto.disponible"
                    class="btn btn-secondary btn-lg"
                    disabled>
              ‚è≥ Auto No Disponible
            </button>
            <button class="btn btn-outline-secondary"
                    (click)="volverALista()">
              ‚Üê Volver a la lista
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- CONTACT MODAL -->
<div class="modal fade" 
     id="contactModal" 
     tabindex="-1" 
     [class.show]="showContactModal"
     [style.display]="showContactModal ? 'block' : 'none'"
     role="dialog">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      
      <!-- MODAL HEADER -->
      <div class="modal-header">
        <h5 class="modal-title">
          Contactar sobre: {{ auto?.marca?.nombre }} {{ auto?.modelo }}
        </h5>
        <button type="button" 
                class="btn-close" 
                (click)="closeContactModal()"></button>
      </div>

      <!-- MODAL BODY -->
      <div class="modal-body">
        <form (ngSubmit)="contactarVendedor()">
          
          <!-- NOMBRES -->
          <div class="mb-3">
            <label for="nombres" class="form-label fw-bold">Nombres *</label>
            <input type="text" 
                   class="form-control" 
                   id="nombres"
                   [(ngModel)]="contactData.nombres"
                   name="nombres"
                   placeholder="Juan"
                   required>
          </div>

          <!-- APELLIDOS -->
          <div class="mb-3">
            <label for="apellidos" class="form-label fw-bold">Apellidos *</label>
            <input type="text" 
                   class="form-control" 
                   id="apellidos"
                   [(ngModel)]="contactData.apellidos"
                   name="apellidos"
                   placeholder="P√©rez Garc√≠a"
                   required>
          </div>

          <!-- DNI -->
          <div class="mb-3">
            <label for="dni" class="form-label fw-bold">DNI *</label>
            <input type="text" 
                   class="form-control" 
                   id="dni"
                   [(ngModel)]="contactData.dni"
                   name="dni"
                   placeholder="12345678"
                   required>
          </div>

          <!-- TEL√âFONO -->
          <div class="mb-3">
            <label for="telefono" class="form-label fw-bold">Tel√©fono *</label>
            <input type="tel" 
                   class="form-control" 
                   id="telefono"
                   [(ngModel)]="contactData.telefono"
                   name="telefono"
                   placeholder="+51 987654321"
                   required>
          </div>

          <!-- DIRECCI√ìN -->
          <div class="mb-3">
            <label for="direccion" class="form-label fw-bold">Direcci√≥n *</label>
            <textarea class="form-control" 
                      id="direccion"
                      [(ngModel)]="contactData.direccion"
                      name="direccion"
                      rows="3"
                      placeholder="Calle Principal 123, Apt 4..."
                      required></textarea>
          </div>

          <!-- MODAL FOOTER -->
          <div class="d-flex gap-2 mt-4">
            <button type="button" 
                    class="btn btn-secondary flex-grow-1"
                    (click)="closeContactModal()">
              Cancelar
            </button>
            <button type="submit" 
                    class="btn btn-primary flex-grow-1">
              ‚úÖ Enviar Solicitud
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- MODAL BACKDROP -->
<div class="modal-backdrop fade" 
     [class.show]="showContactModal"
     *ngIf="showContactModal"
     (click)="closeContactModal()"></div>
<div class="container">
  <div class="form-header">
    <h1>Agregar Nuevo Auto</h1>
    <button class="btn btn-secondary" (click)="volver()">← Volver</button>
  </div>

  <div *ngIf="error" class="alert alert-error">{{ error }}</div>
  <div *ngIf="success" class="alert alert-success">{{ success }}</div>

  <form (ngSubmit)="onSubmit()" #autoForm="ngForm" class="auto-form">

    <!-- Información Básica -->
    <div class="form-section">
      <h3>Información Básica</h3>
      <div class="form-grid">
        <div class="form-group">
          <label for="marca">Marca *</label>
          <select id="marca" name="marcaId" #marcaId="ngModel" [(ngModel)]="auto.marcaId" required
            [disabled]="loadingMarcas" [class.is-invalid]="marcaId.invalid && (marcaId.dirty || marcaId.touched)">
            <option value="">-- Selecciona una marca --</option>
            <option *ngFor="let marca of marcas" [value]="marca.id">{{ marca.nombre }}</option>
          </select>
          <small *ngIf="loadingMarcas" class="text-muted">Cargando marcas...</small>
          <small *ngIf="marcaId.invalid && (marcaId.dirty || marcaId.touched)" class="text-danger">La marca es
            obligatoria</small>
        </div>

        <div class="form-group">
          <label for="modelo">Modelo *</label>
          <input type="text" id="modelo" name="modelo" #modelo="ngModel" [(ngModel)]="auto.modelo" required
            [class.is-invalid]="modelo.invalid && (modelo.dirty || modelo.touched)">
          <small *ngIf="modelo.invalid && (modelo.dirty || modelo.touched)" class="text-danger">El modelo es
            obligatorio</small>
        </div>

        <div class="form-group">
          <label for="anio">Año *</label>
          <input type="number" id="anio" name="anio" #anio="ngModel" [(ngModel)]="auto.anio" min="2000" max="2030"
            required [class.is-invalid]="anio.invalid && (anio.dirty || anio.touched)">
          <small *ngIf="anio.invalid && (anio.dirty || anio.touched)" class="text-danger">El año es obligatorio
            (2000-2030)</small>
        </div>

        <div class="form-group">
          <label for="precio">Precio ($) *</label>
          <input type="number" id="precio" name="precio" #precio="ngModel" [(ngModel)]="auto.precio" min="0" step="0.01"
            required [class.is-invalid]="precio.invalid && (precio.dirty || precio.touched)">
          <small *ngIf="precio.invalid && (precio.dirty || precio.touched)" class="text-danger">El precio es
            obligatorio</small>
        </div>

        <div class="form-group">
          <label for="color">Color</label>
          <input type="text" id="color" name="color" [(ngModel)]="auto.color">
        </div>

        <div class="form-group">
          <label for="condicion">Condición *</label>
          <select id="condicion" name="condicionId" #condicionId="ngModel" [(ngModel)]="auto.condicionId" required
            [disabled]="loadingCondiciones" (ngModelChange)="onCondicionChange($event)"
            [class.is-invalid]="condicionId.invalid && (condicionId.dirty || condicionId.touched)">
            <option value="">-- Selecciona condición --</option>
            <option *ngFor="let cond of condiciones" [value]="cond.id">{{ cond.nombre }}</option>
          </select>
          <small *ngIf="loadingCondiciones" class="text-muted">Cargando condiciones...</small>
          <small *ngIf="condicionId.invalid && (condicionId.dirty || condicionId.touched)" class="text-danger">La
            condición es obligatoria</small>
        </div>

        <div class="form-group">
          <label for="kilometraje">Kilometraje</label>
          <input type="number" id="kilometraje" name="kilometraje" #kilometraje="ngModel" [(ngModel)]="auto.kilometraje"
            min="0" [disabled]="kilometrajeDisabled"
            [placeholder]="kilometrajeDisabled ? '0 (Nuevo)' : 'Ingrese kilometraje (Usado)'"
            [class.is-invalid]="kilometraje.invalid && (kilometraje.dirty || kilometraje.touched)">
          <small *ngIf="kilometrajeDisabled" class="text-info">Kilometraje 0 para autos nuevos</small>
        </div>

        <div class="form-group">
          <label for="stock">Stock</label>
          <input type="number" id="stock" name="stock" [(ngModel)]="auto.stock" min="0"
            placeholder="Cantidad disponible">
        </div>
      </div>
    </div>

    <!-- Especificaciones -->
    <div class="form-section">
      <h3>Especificaciones</h3>
      <div class="form-grid">
        <div class="form-group">
          <select id="combustible" name="combustibleId" #combustibleId="ngModel" [(ngModel)]="auto.combustibleId"
            required [disabled]="loadingCombustibles"
            [class.is-invalid]="combustibleId.invalid && (combustibleId.dirty || combustibleId.touched)">
            <option value="">-- Selecciona combustible --</option>
            <option *ngFor="let comb of combustibles" [value]="comb.id">{{ comb.nombre }}</option>
          </select>
          <small *ngIf="loadingCombustibles" class="text-muted">Cargando combustibles...</small>
          <small *ngIf="combustibleId.invalid && (combustibleId.dirty || combustibleId.touched)" class="text-danger">El
            combustible es obligatorio</small>
        </div>

        <div class="form-group">
          <select id="transmision" name="transmisionId" #transmisionId="ngModel" [(ngModel)]="auto.transmisionId"
            required [disabled]="loadingTransmisiones"
            [class.is-invalid]="transmisionId.invalid && (transmisionId.dirty || transmisionId.touched)">
            <option value="">-- Selecciona transmisión --</option>
            <option *ngFor="let trans of transmisiones" [value]="trans.id">{{ trans.nombre }}</option>
          </select>
          <small *ngIf="loadingTransmisiones" class="text-muted">Cargando transmisiones...</small>
          <small *ngIf="transmisionId.invalid && (transmisionId.dirty || transmisionId.touched)" class="text-danger">La
            transmisión es obligatoria</small>
        </div>

        <div class="form-group">
          <select id="categoria" name="categoriaId" #categoriaId="ngModel" [(ngModel)]="auto.categoriaId" required
            [disabled]="loadingCategorias"
            [class.is-invalid]="categoriaId.invalid && (categoriaId.dirty || categoriaId.touched)">
            <option value="">-- Selecciona categoría --</option>
            <option *ngFor="let cat of categorias" [value]="cat.id">{{ cat.nombre }}</option>
          </select>
          <small *ngIf="loadingCategorias" class="text-muted">Cargando categorías...</small>
          <small *ngIf="categoriaId.invalid && (categoriaId.dirty || categoriaId.touched)" class="text-danger">La
            categoría es obligatoria</small>
        </div>


      </div>
    </div>

    <!-- Descripción -->
    <div class="form-section">
      <h3>Descripción</h3>
      <div class="form-group">
        <textarea id="descripcion" name="descripcion" [(ngModel)]="auto.descripcion"
          placeholder="Describe el auto, características, estado, etc..." rows="4">
        </textarea>
      </div>
    </div>

    <!-- Imágenes -->
    <div class="form-section">
      <div class="section-header">
        <h3>Imágenes del Auto</h3>
        <button type="button" class="btn btn-outline" (click)="agregarImagen()">+ Agregar Imagen</button>
      </div>

      <div *ngFor="let imagen of auto.imagenes; let i = index" class="image-input-group">
        <div class="image-input">
          <label>URL de Imagen {{ i + 1 }}</label>
          <input type="url" [name]="'imagen' + i" [(ngModel)]="auto.imagenes[i]"
            placeholder="https://ejemplo.com/imagen.jpg">
        </div>
        <button type="button" class="btn btn-danger" (click)="eliminarImagen(i)" *ngIf="auto.imagenes.length > 1">
          ✕
        </button>
      </div>

      <p class="help-text">Agrega URLs de imágenes del auto. Mínimo 1 imagen.</p>
    </div>

    <!-- Botones -->
    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="volver()">Cancelar</button>
      <button type="submit" class="btn btn-primary">
        {{ loading ? 'Creando...' : 'Crear Auto' }}
      </button>
    </div>
  </form>
</div>
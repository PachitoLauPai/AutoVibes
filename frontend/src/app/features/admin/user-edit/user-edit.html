<div class="container">
  <div class="form-header">
    <h1>Editar Usuario: {{ usuario?.nombre }}</h1>
    <button class="btn btn-secondary" (click)="volver()">â† Volver</button>
  </div>

  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Cargando usuario...</p>
  </div>

  <div *ngIf="error" class="alert alert-error">{{ error }}</div>
  <div *ngIf="success" class="alert alert-success">{{ success }}</div>

  <form *ngIf="!loading && usuario" (ngSubmit)="onSubmit()" #userForm="ngForm" class="user-form">
    
    <!-- InformaciÃ³n Personal .-->
    <div class="form-section">
      <h3>InformaciÃ³n Personal</h3>
      
      <div class="form-grid">
        <div class="form-group">
          <label for="nombre">Nombre Completo *</label>
          <input 
            type="text" 
            id="nombre" 
            name="nombre" 
            [(ngModel)]="usuarioEditado.nombre" 
            required
            placeholder="Ingresa el nombre completo">
        </div>

        <div class="form-group">
          <label for="email">Email *</label>
          <input 
            type="email" 
            id="email" 
            name="email" 
            [(ngModel)]="usuarioEditado.email" 
            required
            placeholder="usuario@ejemplo.com">
        </div>
      </div>

      <!-- ContraseÃ±a Actual -->
      <div class="form-group">
        <label for="passwordActual">ContraseÃ±a Actual</label>
        <div class="password-display">
          <span class="password-value">{{ usuarioEditado.passwordActual || 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢' }}</span>
          <button 
            type="button"
            class="btn-toggle-password"
            (click)="mostrarPassword = !mostrarPassword"
            tabindex="-1">
            <span *ngIf="!mostrarPassword">ğŸ‘ï¸ Ver</span>
            <span *ngIf="mostrarPassword">ğŸ‘ï¸â€ğŸ—¨ï¸ Ocultar</span>
          </button>
        </div>
        <small class="help-text">Usa el campo a continuaciÃ³n para cambiarla</small>
      </div>

      <!-- Nueva ContraseÃ±a (Opcional) -->
      <div class="form-group">
        <label for="password">Nueva ContraseÃ±a (Opcional)</label>
        <div class="password-input-wrapper">
          <input 
            [type]="mostrarPasswordNueva ? 'text' : 'password'"
            id="password" 
            name="password" 
            [(ngModel)]="usuarioEditado.password"
            placeholder="Dejar vacÃ­o para no cambiar">
          <button 
            type="button"
            class="btn-toggle-password"
            (click)="mostrarPasswordNueva = !mostrarPasswordNueva"
            tabindex="-1">
            <span *ngIf="!mostrarPasswordNueva">ğŸ‘ï¸ Ver</span>
            <span *ngIf="mostrarPasswordNueva">ğŸ‘ï¸â€ğŸ—¨ï¸ Ocultar</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Tipo de Usuario -->
    <div class="form-section">
      <h3>Tipo de Usuario</h3>
      
      <div class="form-group">
        <label for="rol">Rol del Usuario *</label>
        <select id="rol" name="rol" [(ngModel)]="usuarioEditado.rol" required>
          <option *ngFor="let role of roles" [value]="role.value">
            {{ role.label }}
          </option>
        </select>
        
        <div class="help-text" *ngIf="esUsuarioActual()">
          âš ï¸ <strong>EstÃ¡s editando tu propio usuario.</strong> Ten cuidado al cambiar tu rol.
        </div>
        
        <div class="help-text" *ngIf="!esUsuarioActual()">
          â„¹ï¸ Los administradores tienen acceso completo al sistema
        </div>
      </div>
    </div>

    <!-- InformaciÃ³n Adicional -->
    <div class="form-section">
      <h3>InformaciÃ³n Adicional</h3>
      
      <div class="info-grid">
        <div class="info-item">
          <label>ID del Usuario:</label>
          <span class="info-value">{{ usuario.id }}</span>
        </div>
        
        <div class="info-item">
          <label>Estado:</label>
          <span class="info-value status-active">ğŸŸ¢ Activo</span>
        </div>
        
        <div class="info-item">
          <label>Fecha de Registro:</label>
          <span class="info-value">{{ formatearFecha(usuario.fechaCreacion) }}</span>
        </div>

        <div class="info-item" *ngIf="usuario.fechaActualizacion">
          <label>Ãšltima ActualizaciÃ³n:</label>
          <span class="info-value">{{ formatearFecha(usuario.fechaActualizacion) }}</span>
        </div>
      </div>
    </div>

    <!-- Botones -->
    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="volver()">
        Cancelar
      </button>
      <button 
        type="submit" 
        class="btn btn-primary" 
        [disabled]="saving || !usuarioEditado.nombre || !usuarioEditado.email || !usuarioEditado.rol">
        {{ saving ? 'Guardando...' : 'Guardar Cambios' }}
      </button>
    </div>
  </form>
</div>
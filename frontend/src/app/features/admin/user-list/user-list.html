<div class="container">
  <div class="header">
    <div class="header-content">
      <h1>GestiÃ³n de Usuarios</h1>
      <button class="btn btn-secondary" (click)="volver()">â† Volver</button>
    </div>
  </div>

  <!-- EstadÃ­sticas -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">ğŸ‘¥</div>
      <div class="stat-info">
        <h3>{{ getTotalUsuarios() }}</h3>
        <p>Total Usuarios</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon">ğŸ‘‘</div>
      <div class="stat-info">
        <h3>{{ getTotalAdmins() }}</h3>
        <p>Administradores</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon">ğŸ‘¤</div>
      <div class="stat-info">
        <h3>{{ getTotalClientes() }}</h3>
        <p>Clientes</p>
      </div>
    </div>
  </div>

  <!-- Barra de acciones -->
  <div class="action-bar">
    <button class="btn btn-success" (click)="registrarNuevoUsuario()">
      + Registrar Nuevo Usuario
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Cargando usuarios...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error && !loading" class="error">
    {{ error }}
  </div>

  <!-- Lista de usuarios -->
  <div *ngIf="!loading && !error" class="users-container">
    <div *ngIf="usuarios.length === 0" class="empty-state">
      <h3>No hay usuarios registrados</h3>
      <p>Comienza registrando el primer usuario.</p>
      <button class="btn btn-primary" (click)="registrarNuevoUsuario()">
        Registrar Usuario
      </button>
    </div>

    <div *ngIf="usuarios.length > 0" class="users-grid">
      <div *ngFor="let usuario of usuarios" class="user-card">
        <div class="user-avatar">
          {{ getRolIcon(usuario.rol) }}
        </div>
        
        <div class="user-info">
          <h3>{{ usuario.nombre }}</h3>
          <p class="user-email">{{ usuario.email }}</p>
          <div class="user-details">
            <!-- âœ… CORREGIDO: usar getRolNombre() -->
            <span class="badge" [class]="getRolBadgeClass(usuario.rol)">
              {{ getRolNombre(usuario.rol) }}
            </span>
            <span class="user-id">ID: {{ usuario.id }}</span>
            <span class="user-date" *ngIf="usuario.fechaCreacion">
              ğŸ“… {{ formatearFecha(usuario.fechaCreacion) }}
            </span>
          </div>
        </div>

        <div class="user-actions">
          <div class="user-status">
            <span class="status-dot" [class.active]="usuario.activo" [class.inactive]="!usuario.activo"></span>
            {{ usuario.activo ? 'Activo' : 'Inactivo' }}
            <span *ngIf="esUsuarioActual(usuario)" class="current-user-badge">(TÃº)</span>
          </div>

          <!-- Botones de admin -->
          <div class="action-buttons" *ngIf="authService.isAdmin()">
            <button class="btn btn-warning btn-sm" (click)="editarUsuario(usuario)" title="Editar">
              âœï¸
            </button>
            <button 
              class="btn btn-info btn-sm" 
              (click)="cambiarEstadoUsuario(usuario)"
              [title]="usuario.activo ? 'Desactivar' : 'Activar'">
              {{ usuario.activo ? 'ğŸš«' : 'âœ…' }}
            </button>
            <button 
              class="btn btn-danger btn-sm" 
              (click)="eliminarUsuario(usuario)"
              [disabled]="esUsuarioActual(usuario)"
              [title]="esUsuarioActual(usuario) ? 'No puedes eliminar tu propio usuario' : 'Eliminar'">
              ğŸ—‘ï¸
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
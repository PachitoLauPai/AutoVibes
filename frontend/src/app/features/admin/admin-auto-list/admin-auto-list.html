<div class="admin-autos-container">
  <!-- Premium Header -->
  <div class="admin-header-premium">
    <div class="header-background">
      <div class="header-shape shape-1"></div>
      <div class="header-shape shape-2"></div>
    </div>
    
    <div class="header-content-wrapper">
      <div class="header-left">
        <div class="header-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
          </svg>
        </div>
        <div class="header-text">
          <h1 class="header-title">Gesti√≥n de Autos</h1>
          <p class="header-subtitle">Administra tu cat√°logo de veh√≠culos</p>
          <div class="header-stats">
            <span class="stat-badge"><strong>{{ autos.length }}</strong> Total</span>
          </div>
        </div>
      </div>
      
      <button class="btn-add-auto-premium" (click)="abrirCrearAuto()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 5v14M5 12h14"/>
        </svg>
        <span>Agregar Nuevo Auto</span>
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando autos...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-banner">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="8" x2="12" y2="12"></line>
      <line x1="12" y1="16" x2="12.01" y2="16"></line>
    </svg>
    <div>
      <h3>Error</h3>
      <p>{{ error }}</p>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && autosFilterados.length === 0" class="empty-state">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M19 17h2v.5M1 7h22v10H1zM6.5 17a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0zM22.5 17a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"/>
    </svg>
    <h3>No hay autos registrados</h3>
    <p>Comienza agregando un nuevo veh√≠culo a tu cat√°logo</p>
    <button class="btn-add-auto-premium" (click)="abrirCrearAuto()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 5v14M5 12h14"/>
      </svg>
      Crear Primer Auto
    </button>
  </div>

  <!-- Filters and Search -->
  <div *ngIf="!loading && !error && autos.length > 0" class="filters-section">
    <div class="search-box">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"/>
      </svg>
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        placeholder="Buscar por marca, modelo o color..."
        class="search-input"
      />
    </div>
    <div class="filter-buttons">
      <button 
        [class.active]="selectedFilter === 'todos'"
        (click)="selectedFilter = 'todos'"
        class="filter-btn"
      >
        Todos ({{ autos.length }})
      </button>
      <button 
        [class.active]="selectedFilter === 'disponibles'"
        (click)="selectedFilter = 'disponibles'"
        class="filter-btn"
      >
        Disponibles ({{ autosDisponibles }})
      </button>
      <button 
        [class.active]="selectedFilter === 'noDisponibles'"
        (click)="selectedFilter = 'noDisponibles'"
        class="filter-btn"
      >
        No Disponibles ({{ autosNoDisponibles }})
      </button>
    </div>
  </div>

  <!-- Autos Grid -->
  <div *ngIf="!loading && !error && autosFilterados.length > 0" class="autos-grid">
    <div *ngFor="let auto of autosFilterados" class="auto-card">
      <!-- Card Header -->
      <div class="card-header">
        <div class="availability-badge" [class.available]="auto.disponible">
          {{ auto.disponible ? 'Disponible' : 'No Disponible' }}
        </div>
        <div class="card-actions-top">
          <button class="action-icon" (click)="abrirEditarAuto(auto)" title="Editar">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Card Image -->
      <div class="card-image">
        <img 
          [src]="(auto.imagenes && auto.imagenes.length > 0) ? auto.imagenes[0] : 'assets/placeholder-car.jpg'" 
          [alt]="auto.marca?.nombre + ' ' + auto.modelo"
          onerror="this.src='assets/placeholder-car.jpg'"
        />
      </div>

      <!-- Card Body -->
      <div class="card-body">
        <h3 class="auto-title">{{ auto.marca?.nombre }} {{ auto.modelo }}</h3>
        <div class="auto-specs">
          <span class="spec">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            {{ auto.anio }}
          </span>
          <span class="spec">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 12c0-1.657.895-3.107 2.232-3.9M4 12c0 1.657.895 3.107 2.232 3.9M4 12h16m-4-3.9c1.337-.793 2.232-2.243 2.232-3.9M4.464 8.1C5.8 7.307 7.27 6.8 8.85 6.8M20 12c0-1.657-.895-3.107-2.232-3.9M20 12c0 1.657-.895 3.107-2.232 3.9m4 0C22.2 12 23 10.657 23 9c0-1.657-.8-3-1.768-3.9"/>
            </svg>
            {{ auto.color }}
          </span>
          <span class="spec">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M13 2H3v20h18V8z"/><polyline points="13 2 13 8 19 8"/>
            </svg>
            {{ auto.kilometraje | number:'1.0-0' }} km
          </span>
        </div>

        <div class="auto-info">
          <div class="info-row">
            <span class="label">Categor√≠a:</span>
            <span class="value">{{ auto.categoria?.nombre || 'N/A' }}</span>
          </div>
          <div class="info-row">
            <span class="label">Combustible:</span>
            <span class="value">{{ auto.combustible?.nombre || 'N/A' }}</span>
          </div>
          <div class="info-row">
            <span class="label">Transmisi√≥n:</span>
            <span class="value">{{ auto.transmision?.nombre || 'N/A' }}</span>
          </div>
          <div class="info-row">
            <span class="label">Stock:</span>
            <span class="value stock-badge" [ngClass]="{'low-stock': auto.stock <= 2, 'medium-stock': auto.stock > 2 && auto.stock <= 5, 'high-stock': auto.stock > 5}">
              {{ auto.stock }} unidades
            </span>
          </div>
        </div>

        <div class="price-section">
          <p class="price">${{ auto.precio | number:'1.2-2' }}</p>
        </div>
      </div>

      <!-- Card Footer -->
      <div class="card-footer">
        <button class="btn-secondary" (click)="abrirDetalles(auto)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
            <circle cx="12" cy="12" r="3"/>
          </svg>
          Ver Detalles
        </button>
        <button class="btn-edit" (click)="abrirEditarAuto(auto)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>
          </svg>
          Editar
        </button>
        <button class="btn-delete" (click)="eliminarAuto(auto)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/>
          </svg>
          Eliminar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Crear/Editar/Ver Detalles Auto -->
<div class="modal-overlay" *ngIf="showModal" (click)="cerrarModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>
        <span *ngIf="modalMode === 'crear'">Agregar Nuevo Auto</span>
        <span *ngIf="modalMode === 'editar'">Editar Auto</span>
        <span *ngIf="modalMode === 'detalles'">Detalles del Auto</span>
      </h2>
      <button class="close-btn" (click)="cerrarModal()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <form [formGroup]="autoForm" class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label>Marca *</label>
          <select formControlName="marca" [disabled]="isFormDisabled" class="form-control">
            <option value="">Selecciona una marca</option>
            <option *ngFor="let marca of marcas" [value]="marca.id">{{ marca.nombre }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Modelo *</label>
          <input type="text" formControlName="modelo" [disabled]="isFormDisabled" class="form-control" placeholder="Ej: Corolla">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>A√±o *</label>
          <input type="number" formControlName="anio" [disabled]="isFormDisabled" class="form-control" placeholder="2024">
        </div>
        <div class="form-group">
          <label>Precio *</label>
          <input type="number" formControlName="precio" [disabled]="isFormDisabled" class="form-control" placeholder="25000.00" step="0.01">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Color *</label>
          <input type="text" formControlName="color" [disabled]="isFormDisabled" class="form-control" placeholder="Rojo">
        </div>
        <div class="form-group">
          <label>Kilometraje *</label>
          <input type="number" formControlName="kilometraje" [disabled]="isFormDisabled" class="form-control" placeholder="0">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Stock *</label>
          <input type="number" formControlName="stock" [disabled]="isFormDisabled" class="form-control" placeholder="0" min="0">
        </div>
        <div class="form-group">
          <!-- Empty for grid layout -->
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Categor√≠a *</label>
          <select formControlName="categoria" [disabled]="isFormDisabled" class="form-control">
            <option value="">Selecciona una categor√≠a</option>
            <option *ngFor="let cat of categorias" [value]="cat.id">{{ cat.nombre }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Combustible *</label>
          <select formControlName="combustible" [disabled]="isFormDisabled" class="form-control">
            <option value="">Selecciona un combustible</option>
            <option *ngFor="let comb of combustibles" [value]="comb.id">{{ comb.nombre }}</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Transmisi√≥n *</label>
          <select formControlName="transmision" [disabled]="isFormDisabled" class="form-control">
            <option value="">Selecciona una transmisi√≥n</option>
            <option *ngFor="let trans of transmisiones" [value]="trans.id">{{ trans.nombre }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Condici√≥n *</label>
          <select formControlName="condicion" [disabled]="isFormDisabled" class="form-control">
            <option value="">Selecciona la condici√≥n</option>
            <option value="1">Nuevo</option>
            <option value="2">Usado</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label>Descripci√≥n *</label>
        <textarea formControlName="descripcion" [disabled]="isFormDisabled" class="form-control" placeholder="Descripci√≥n del veh√≠culo" rows="4"></textarea>
      </div>

      <!-- Disponible - Checkbox en editar/crear, texto en detalles -->
      <div *ngIf="modalMode !== 'detalles'" class="form-group checkbox">
        <input type="checkbox" formControlName="disponible" [disabled]="isFormDisabled" id="disponible">
        <label for="disponible">Disponible para venta</label>
      </div>

      <div *ngIf="modalMode === 'detalles'" class="form-group">
        <label>Estado de Disponibilidad</label>
        <div class="status-display" [class.available]="autoForm.get('disponible')?.value">
          {{ autoForm.get('disponible')?.value ? '‚úì Disponible para venta' : '‚úó No Disponible' }}
        </div>
      </div>

      <!-- Im√°genes -->
      <div class="form-group" *ngIf="modalMode !== 'detalles'">
        <label>Im√°genes</label>
        <div class="image-upload-section">
          <!-- Opci√≥n 1: Upload por archivo -->
          <div class="image-input-method">
            <h4 class="method-title">üì§ Subir por Archivo</h4>
            <input type="file" #fileInput (change)="onImageSelected($event)" accept="image/*" style="display: none;">
            <button type="button" class="btn-upload-image" (click)="fileInput.click()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/>
              </svg>
              Seleccionar Archivo
            </button>
          </div>

          <!-- Opci√≥n 2: Agregar por URL -->
          <div class="image-input-method">
            <h4 class="method-title">üîó O Pegar URL</h4>
            <div class="url-input-group">
              <input 
                type="text" 
                #imageUrlInput 
                placeholder="https://ejemplo.com/imagen.jpg" 
                class="form-control url-input"
                (keyup.enter)="addImageFromUrl(imageUrlInput.value); imageUrlInput.value = ''"
              />
              <button 
                type="button" 
                class="btn-add-url" 
                (click)="addImageFromUrl(imageUrlInput.value); imageUrlInput.value = ''"
              >
                Agregar
              </button>
            </div>
          </div>

          <!-- Galer√≠a de im√°genes -->
          <div class="images-list" *ngIf="autoForm.get('imagenes')?.value && autoForm.get('imagenes')?.value.length > 0">
            <div class="image-preview" *ngFor="let img of autoForm.get('imagenes')?.value; let i = index">
              <img [src]="img" [alt]="'Imagen ' + (i+1)" onerror="this.src='assets/placeholder-car.jpg'">
              <button type="button" class="btn-remove-image" (click)="removeImage(i)">
                ‚úï
              </button>
            </div>
          </div>

          <!-- Mensaje cuando no hay im√°genes -->
          <p class="text-muted" *ngIf="!autoForm.get('imagenes')?.value || autoForm.get('imagenes')?.value.length === 0">
            No hay im√°genes agregadas (m√°ximo 5)
          </p>
        </div>
      </div>

      <!-- Im√°genes en detalles - solo lectura -->
      <div class="form-group" *ngIf="modalMode === 'detalles' && selectedAuto && selectedAuto?.imagenes && selectedAuto.imagenes.length > 0">
        <label>Im√°genes</label>
        <div class="images-list">
          <div class="image-preview" *ngFor="let img of selectedAuto?.imagenes || []; let i = index">
            <img [src]="img" [alt]="'Imagen ' + (i+1)" onerror="this.src='assets/placeholder-car.jpg'">
          </div>
        </div>
      </div>
    </form>

    <div class="modal-footer">
      <button class="btn-cancel" (click)="cerrarModal()">
        {{ modalMode === 'detalles' ? 'Cerrar' : 'Cancelar' }}
      </button>
      <button class="btn-save" (click)="guardarAuto()" *ngIf="modalMode !== 'detalles'" [disabled]="submitting || autoForm.invalid">
        <span *ngIf="!submitting">{{ modalMode === 'crear' ? 'Crear Auto' : 'Guardar Cambios' }}</span>
        <span *ngIf="submitting">Guardando...</span>
      </button>
    </div>
  </div>
</div>
